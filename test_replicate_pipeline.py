#!/usr/bin/env python3
"""
Test Professional Video Enhancement Pipeline using Replicate API
Ğ¡ĞµÑ€Ğ²Ğ¸Ñ: https://replicate.com

Pipeline:
1. Real-ESRGAN - upscaling + face enhancement
2. CodeFormer/GFPGAN - face restoration
3. Background removal (optional)

Ğ”Ğ»Ñ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ:
1. pip install replicate
2. export REPLICATE_API_TOKEN=your_token
3. python test_replicate_pipeline.py
"""

import os
import sys
from pathlib import Path

def demo_pipeline():
    """Show demo of what the pipeline does"""
    print("""
ğŸ“¦ Ğ Ğ•ĞšĞĞœĞ•ĞĞ”Ğ£Ğ•ĞœĞ«Ğ™ PIPELINE Ğ”Ğ›Ğ¯ PERS.COACH:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     INPUT: Ğ”Ğ¾Ğ¼Ğ°ÑˆĞ½ĞµĞµ Ğ²Ğ¸Ğ´ĞµĞ¾                    â”‚
â”‚                    (720p, Ğ¿Ğ»Ğ¾Ñ…Ğ¾Ğ¹ ÑĞ²ĞµÑ‚, ÑˆÑƒĞ¼)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1ï¸âƒ£  MODNet - Background Removal                            â”‚
â”‚     â€¢ Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾ Ğ½Ğ° MacBook (Ğ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ¾)                       â”‚
â”‚     â€¢ ~0.1 ÑĞµĞº/ĞºĞ°Ğ´Ñ€                                         â”‚
â”‚     â€¢ Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ Ğ´Ğ¾Ğ¼Ğ°ÑˆĞ½Ğ¸Ğ¹ Ñ„Ğ¾Ğ½                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2ï¸âƒ£  Real-ESRGAN - Upscaling + Face Enhancement            â”‚
â”‚     â€¢ Replicate API: $0.0023/ĞºĞ°Ğ´Ñ€                           â”‚
â”‚     â€¢ ~2 ÑĞµĞº/ĞºĞ°Ğ´Ñ€ (T4 GPU)                                  â”‚
â”‚     â€¢ 720p â†’ 1440p (2x) Ğ¸Ğ»Ğ¸ 4K (4x)                        â”‚
â”‚     â€¢ Ğ’ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ½Ğ¾Ğµ ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ğµ Ğ»Ğ¸Ñ†Ğ°                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3ï¸âƒ£  CodeFormer - Face Restoration (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)           â”‚
â”‚     â€¢ Replicate API: $0.002/ĞºĞ°Ğ´Ñ€                            â”‚
â”‚     â€¢ ~1 ÑĞµĞº/ĞºĞ°Ğ´Ñ€                                           â”‚
â”‚     â€¢ Ğ£Ğ»ÑƒÑ‡ÑˆĞ°ĞµÑ‚ Ñ‡ĞµÑ€Ñ‚Ñ‹ Ğ»Ğ¸Ñ†Ğ°, ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑÑ Ğ¸Ğ´ĞµĞ½Ñ‚Ğ¸Ñ‡Ğ½Ğ¾ÑÑ‚ÑŒ           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4ï¸âƒ£  Color Correction - ĞŸÑ€Ğ¾Ñ„ĞµÑÑĞ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ñ†Ğ²ĞµÑ‚Ğ°             â”‚
â”‚     â€¢ Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾ (Ğ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ¾)                                  â”‚
â”‚     â€¢ ~0.01 ÑĞµĞº/ĞºĞ°Ğ´Ñ€                                        â”‚
â”‚     â€¢ LUT Ğ¿Ñ€ĞµÑĞµÑ‚Ñ‹ Ğ´Ğ»Ñ Ñ„Ğ¸Ñ‚Ğ½ĞµÑ-Ğ²Ğ¸Ğ´ĞµĞ¾                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5ï¸âƒ£  Background Replacement                                 â”‚
â”‚     â€¢ Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾ (Ğ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ¾)                                  â”‚
â”‚     â€¢ ĞŸÑ€Ğ¾Ñ„ĞµÑÑĞ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞµÑ€Ñ‹Ğ¹ Ñ„Ğ¾Ğ½                            â”‚
â”‚     â€¢ Ğ˜Ğ»Ğ¸ AI-ÑĞ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ ÑĞ¿Ğ¾Ñ€Ñ‚Ğ·Ğ°Ğ»                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    OUTPUT: ĞŸÑ€Ğ¾Ñ„ĞµÑÑĞ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ²Ğ¸Ğ´ĞµĞ¾            â”‚
â”‚                   (1440p/4K, ÑÑ‚ÑƒĞ´Ğ¸Ğ¹Ğ½Ñ‹Ğ¹ ÑĞ²ĞµÑ‚, Ñ‡Ğ¸ÑÑ‚Ğ¾Ğµ)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ’° Ğ¡Ğ¢ĞĞ˜ĞœĞĞ¡Ğ¢Ğ¬ (Ğ´Ğ»Ñ 30-ÑĞµĞº Ğ²Ğ¸Ğ´ĞµĞ¾ @ 30fps = 900 ĞºĞ°Ğ´Ñ€Ğ¾Ğ²):

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Pipeline           â”‚ Ğ’Ñ€ĞµĞ¼Ñ        â”‚ Ğ¡Ñ‚Ğ¾Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸš€ Fast            â”‚ ~30 Ğ¼Ğ¸Ğ½      â”‚ ~$2.07        â”‚
â”‚ (ESRGAN only)      â”‚              â”‚ ($0.07/ÑĞµĞº)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â­ Quality          â”‚ ~45 Ğ¼Ğ¸Ğ½      â”‚ ~$3.87        â”‚
â”‚ (ESRGAN+CodeFormer)â”‚              â”‚ ($0.13/ÑĞµĞº)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ‘‘ Premium         â”‚ ~60 Ğ¼Ğ¸Ğ½      â”‚ ~$6.30        â”‚
â”‚ (SeedVR2+GFPGAN)   â”‚              â”‚ ($0.21/ÑĞµĞº)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ“Š Ğ¡Ğ ĞĞ’ĞĞ•ĞĞ˜Ğ• Ğ¡ ĞĞ›Ğ¬Ğ¢Ğ•Ğ ĞĞĞ¢Ğ˜Ğ’ĞĞœĞ˜:

â€¢ Topaz Video AI: $299 one-time, Ğ½Ğ¾ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾ Ğ½ÑƒĞ¶ĞµĞ½ Ğ¼Ğ¾Ñ‰Ğ½Ñ‹Ğ¹ GPU
â€¢ Runway ML: $15/month + credits, Ğ±Ğ¾Ğ»ĞµĞµ Ğ´Ğ¾Ñ€Ğ¾Ğ³Ğ¾ Ğ´Ğ»Ñ Ğ²Ğ¸Ğ´ĞµĞ¾
â€¢ ĞĞ°Ñˆ pipeline: Pay-per-use, ~$4/Ğ¼Ğ¸Ğ½ÑƒÑ‚Ğ° Ğ²Ğ¸Ğ´ĞµĞ¾, Ğ¾Ğ±Ğ»Ğ°ĞºĞ¾

ğŸ”§ Ğ£Ğ¡Ğ¢ĞĞĞĞ’ĞšĞ:

pip install replicate opencv-python numpy
export REPLICATE_API_TOKEN=your_token
python test_replicate_pipeline.py input.jpg output/

ğŸ“ Ğ¡Ğ›Ğ•Ğ”Ğ£Ğ®Ğ©Ğ˜Ğ• Ğ¨ĞĞ“Ğ˜:

1. ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Replicate API token
2. ĞŸÑ€Ğ¾Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ½Ğ° Ğ¾Ğ´Ğ½Ğ¾Ğ¼ ĞºĞ°Ğ´Ñ€Ğµ
3. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ batch-Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºÑƒ Ğ´Ğ»Ñ Ğ²Ğ¸Ğ´ĞµĞ¾
4. ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½ÑƒÑ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºÑƒ
5. Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ² web-Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ
""")


# Check for API token
HAS_API_TOKEN = bool(os.environ.get('REPLICATE_API_TOKEN'))

if not HAS_API_TOKEN:
    print("""
âš ï¸  Replicate API token not found!

Ğ§Ñ‚Ğ¾Ğ±Ñ‹ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Replicate:
1. Ğ—Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€ÑƒĞ¹Ñ‚ĞµÑÑŒ Ğ½Ğ° https://replicate.com
2. ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚Ğµ API token: https://replicate.com/account/api-tokens
3. Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚Ğµ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½ÑƒÑ:
   export REPLICATE_API_TOKEN=r8_xxxxxxxxxxxxx

Ğ˜Ğ»Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ Ñ„Ğ°Ğ¹Ğ» .env:
   REPLICATE_API_TOKEN=r8_xxxxxxxxxxxxx

ğŸ’° Ğ¡Ñ‚Ğ¾Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ:
- Real-ESRGAN: ~$0.0023/image (T4 GPU, ~2s)
- Real-ESRGAN A100: ~$0.005/image (A100 GPU, ~0.7s)
- GFPGAN: ~$0.001/image
- CodeFormer: ~$0.002/image

Ğ”Ğ»Ñ 1000 ĞºĞ°Ğ´Ñ€Ğ¾Ğ² Ğ²Ğ¸Ğ´ĞµĞ¾ (30 ÑĞµĞº @ 30fps):
- Real-ESRGAN: ~$2.30
- + Face enhancement: ~$3.30
- Ğ˜Ñ‚Ğ¾Ğ³Ğ¾ ~$0.10/ÑĞµĞº Ğ²Ğ¸Ğ´ĞµĞ¾
""")
    
    # Demo mode - show what would happen
    print("\nğŸ“‹ DEMO MODE - Pipeline Preview:\n")
    demo_pipeline()
    sys.exit(0)

import replicate


def upscale_image_real_esrgan(image_path: str, scale: int = 2, face_enhance: bool = True) -> str:
    """
    Upscale image using Real-ESRGAN
    https://replicate.com/nightmareai/real-esrgan
    
    Args:
        image_path: Path to input image
        scale: Upscale factor (2 or 4)
        face_enhance: Whether to enhance faces
    
    Returns:
        URL of upscaled image
    """
    print(f"ğŸ” Real-ESRGAN: Upscaling {scale}x, face_enhance={face_enhance}")
    
    output = replicate.run(
        "nightmareai/real-esrgan:f121d640bd286e1fdc67f9799164c1d5be36ff74576ee11c803ae5b665dd46aa",
        input={
            "image": open(image_path, "rb"),
            "scale": scale,
            "face_enhance": face_enhance
        }
    )
    
    return output


def restore_face_gfpgan(image_path: str, version: str = "1.4") -> str:
    """
    Restore faces using GFPGAN
    https://replicate.com/tencentarc/gfpgan
    
    Args:
        image_path: Path to input image
        version: GFPGAN version (1.3 or 1.4)
    
    Returns:
        URL of restored image
    """
    print(f"ğŸ‘¤ GFPGAN: Face restoration v{version}")
    
    output = replicate.run(
        "tencentarc/gfpgan:0fbacf7afc6c144e5be9767cff80f25aff23e52b0708f17e20f9879b2f21516c",
        input={
            "img": open(image_path, "rb"),
            "version": version,
            "scale": 2
        }
    )
    
    return output


def restore_face_codeformer(image_path: str, fidelity: float = 0.5) -> str:
    """
    Restore faces using CodeFormer
    https://replicate.com/sczhou/codeformer
    
    Args:
        image_path: Path to input image
        fidelity: Balance between quality and fidelity (0-1)
    
    Returns:
        URL of restored image
    """
    print(f"ğŸ‘¤ CodeFormer: Face restoration, fidelity={fidelity}")
    
    output = replicate.run(
        "sczhou/codeformer:7de2ea26c616d5bf2245ad0d5e24f0ff9a6204578a5c876db53142edd9d2cd56",
        input={
            "image": open(image_path, "rb"),
            "fidelity": fidelity,
            "upscale": 2
        }
    )
    
    return output


def enhance_with_seedvr2(image_path: str) -> str:
    """
    Enhance image using SeedVR2 (ByteDance, CVPR 2025)
    https://replicate.com/zsxkib/seedvr2
    
    State-of-the-art restoration
    """
    print(f"ğŸŒŸ SeedVR2: Professional restoration")
    
    output = replicate.run(
        "zsxkib/seedvr2:6b7dcca8f0a03dddddd6e8c6ab90d5ee1aa6ae3e1d0b0a1b6efb40c6c44e23d5",
        input={
            "image": open(image_path, "rb")
        }
    )
    
    return output


def download_result(url: str, output_path: str):
    """Download result from Replicate"""
    import urllib.request
    print(f"ğŸ’¾ Saving to {output_path}")
    urllib.request.urlretrieve(url, output_path)


def process_single_frame(input_path: str, output_dir: str, pipeline: str = "fast"):
    """
    Process single frame through enhancement pipeline
    
    Pipelines:
    - fast: Real-ESRGAN only (2x + face enhance)
    - quality: Real-ESRGAN 4x + CodeFormer
    - premium: SeedVR2 + GFPGAN
    """
    os.makedirs(output_dir, exist_ok=True)
    base_name = Path(input_path).stem
    
    if pipeline == "fast":
        # Fast pipeline: Real-ESRGAN with face enhancement
        result_url = upscale_image_real_esrgan(input_path, scale=2, face_enhance=True)
        download_result(result_url, f"{output_dir}/{base_name}_fast.png")
        
    elif pipeline == "quality":
        # Quality pipeline: ESRGAN 4x -> CodeFormer
        esrgan_url = upscale_image_real_esrgan(input_path, scale=4, face_enhance=False)
        temp_path = f"{output_dir}/{base_name}_temp.png"
        download_result(esrgan_url, temp_path)
        
        cf_url = restore_face_codeformer(temp_path, fidelity=0.7)
        download_result(cf_url, f"{output_dir}/{base_name}_quality.png")
        os.remove(temp_path)
        
    elif pipeline == "premium":
        # Premium pipeline: SeedVR2 + GFPGAN
        try:
            seed_url = enhance_with_seedvr2(input_path)
            temp_path = f"{output_dir}/{base_name}_temp.png"
            download_result(seed_url, temp_path)
            
            gfpgan_url = restore_face_gfpgan(temp_path)
            download_result(gfpgan_url, f"{output_dir}/{base_name}_premium.png")
            os.remove(temp_path)
        except Exception as e:
            print(f"âš ï¸ Premium pipeline failed, falling back to quality: {e}")
            process_single_frame(input_path, output_dir, "quality")
    
    print(f"âœ… Done: {pipeline} pipeline")


def demo_pipeline():
    """Show demo of what the pipeline does"""
    print("""
ğŸ“¦ Ğ Ğ•ĞšĞĞœĞ•ĞĞ”Ğ£Ğ•ĞœĞ«Ğ™ PIPELINE Ğ”Ğ›Ğ¯ PERS.COACH:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     INPUT: Ğ”Ğ¾Ğ¼Ğ°ÑˆĞ½ĞµĞµ Ğ²Ğ¸Ğ´ĞµĞ¾                    â”‚
â”‚                    (720p, Ğ¿Ğ»Ğ¾Ñ…Ğ¾Ğ¹ ÑĞ²ĞµÑ‚, ÑˆÑƒĞ¼)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1ï¸âƒ£  MODNet - Background Removal                            â”‚
â”‚     â€¢ Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾ Ğ½Ğ° MacBook (Ğ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ¾)                       â”‚
â”‚     â€¢ ~0.1 ÑĞµĞº/ĞºĞ°Ğ´Ñ€                                         â”‚
â”‚     â€¢ Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ Ğ´Ğ¾Ğ¼Ğ°ÑˆĞ½Ğ¸Ğ¹ Ñ„Ğ¾Ğ½                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2ï¸âƒ£  Real-ESRGAN - Upscaling + Face Enhancement            â”‚
â”‚     â€¢ Replicate API: $0.0023/ĞºĞ°Ğ´Ñ€                           â”‚
â”‚     â€¢ ~2 ÑĞµĞº/ĞºĞ°Ğ´Ñ€ (T4 GPU)                                  â”‚
â”‚     â€¢ 720p â†’ 1440p (2x) Ğ¸Ğ»Ğ¸ 4K (4x)                        â”‚
â”‚     â€¢ Ğ’ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ½Ğ¾Ğµ ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ğµ Ğ»Ğ¸Ñ†Ğ°                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3ï¸âƒ£  CodeFormer - Face Restoration (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)           â”‚
â”‚     â€¢ Replicate API: $0.002/ĞºĞ°Ğ´Ñ€                            â”‚
â”‚     â€¢ ~1 ÑĞµĞº/ĞºĞ°Ğ´Ñ€                                           â”‚
â”‚     â€¢ Ğ£Ğ»ÑƒÑ‡ÑˆĞ°ĞµÑ‚ Ñ‡ĞµÑ€Ñ‚Ñ‹ Ğ»Ğ¸Ñ†Ğ°, ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑÑ Ğ¸Ğ´ĞµĞ½Ñ‚Ğ¸Ñ‡Ğ½Ğ¾ÑÑ‚ÑŒ           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4ï¸âƒ£  Color Correction - ĞŸÑ€Ğ¾Ñ„ĞµÑÑĞ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ñ†Ğ²ĞµÑ‚Ğ°             â”‚
â”‚     â€¢ Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾ (Ğ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ¾)                                  â”‚
â”‚     â€¢ ~0.01 ÑĞµĞº/ĞºĞ°Ğ´Ñ€                                        â”‚
â”‚     â€¢ LUT Ğ¿Ñ€ĞµÑĞµÑ‚Ñ‹ Ğ´Ğ»Ñ Ñ„Ğ¸Ñ‚Ğ½ĞµÑ-Ğ²Ğ¸Ğ´ĞµĞ¾                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5ï¸âƒ£  Background Replacement                                 â”‚
â”‚     â€¢ Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾ (Ğ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ¾)                                  â”‚
â”‚     â€¢ ĞŸÑ€Ğ¾Ñ„ĞµÑÑĞ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞµÑ€Ñ‹Ğ¹ Ñ„Ğ¾Ğ½                            â”‚
â”‚     â€¢ Ğ˜Ğ»Ğ¸ AI-ÑĞ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ ÑĞ¿Ğ¾Ñ€Ñ‚Ğ·Ğ°Ğ»                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    OUTPUT: ĞŸÑ€Ğ¾Ñ„ĞµÑÑĞ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ²Ğ¸Ğ´ĞµĞ¾            â”‚
â”‚                   (1440p/4K, ÑÑ‚ÑƒĞ´Ğ¸Ğ¹Ğ½Ñ‹Ğ¹ ÑĞ²ĞµÑ‚, Ñ‡Ğ¸ÑÑ‚Ğ¾Ğµ)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ’° Ğ¡Ğ¢ĞĞ˜ĞœĞĞ¡Ğ¢Ğ¬ (Ğ´Ğ»Ñ 30-ÑĞµĞº Ğ²Ğ¸Ğ´ĞµĞ¾ @ 30fps = 900 ĞºĞ°Ğ´Ñ€Ğ¾Ğ²):

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Pipeline           â”‚ Ğ’Ñ€ĞµĞ¼Ñ        â”‚ Ğ¡Ñ‚Ğ¾Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸš€ Fast            â”‚ ~30 Ğ¼Ğ¸Ğ½      â”‚ ~$2.07        â”‚
â”‚ (ESRGAN only)      â”‚              â”‚ ($0.07/ÑĞµĞº)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â­ Quality          â”‚ ~45 Ğ¼Ğ¸Ğ½      â”‚ ~$3.87        â”‚
â”‚ (ESRGAN+CodeFormer)â”‚              â”‚ ($0.13/ÑĞµĞº)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ‘‘ Premium         â”‚ ~60 Ğ¼Ğ¸Ğ½      â”‚ ~$6.30        â”‚
â”‚ (SeedVR2+GFPGAN)   â”‚              â”‚ ($0.21/ÑĞµĞº)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ“Š Ğ¡Ğ ĞĞ’ĞĞ•ĞĞ˜Ğ• Ğ¡ ĞĞ›Ğ¬Ğ¢Ğ•Ğ ĞĞĞ¢Ğ˜Ğ’ĞĞœĞ˜:

â€¢ Topaz Video AI: $299 one-time, Ğ½Ğ¾ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾ Ğ½ÑƒĞ¶ĞµĞ½ Ğ¼Ğ¾Ñ‰Ğ½Ñ‹Ğ¹ GPU
â€¢ Runway ML: $15/month + credits, Ğ±Ğ¾Ğ»ĞµĞµ Ğ´Ğ¾Ñ€Ğ¾Ğ³Ğ¾ Ğ´Ğ»Ñ Ğ²Ğ¸Ğ´ĞµĞ¾
â€¢ ĞĞ°Ñˆ pipeline: Pay-per-use, ~$4/Ğ¼Ğ¸Ğ½ÑƒÑ‚Ğ° Ğ²Ğ¸Ğ´ĞµĞ¾, Ğ¾Ğ±Ğ»Ğ°ĞºĞ¾

ğŸ”§ Ğ£Ğ¡Ğ¢ĞĞĞĞ’ĞšĞ:

pip install replicate opencv-python numpy
export REPLICATE_API_TOKEN=your_token
python test_replicate_pipeline.py input.jpg output/

ğŸ“ Ğ¡Ğ›Ğ•Ğ”Ğ£Ğ®Ğ©Ğ˜Ğ• Ğ¨ĞĞ“Ğ˜:

1. ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Replicate API token
2. ĞŸÑ€Ğ¾Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ½Ğ° Ğ¾Ğ´Ğ½Ğ¾Ğ¼ ĞºĞ°Ğ´Ñ€Ğµ
3. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ batch-Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºÑƒ Ğ´Ğ»Ñ Ğ²Ğ¸Ğ´ĞµĞ¾
4. ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½ÑƒÑ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºÑƒ
5. Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ² web-Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ
""")


def main():
    """Main entry point"""
    if len(sys.argv) < 2:
        print("Usage: python test_replicate_pipeline.py <input_image> [output_dir] [pipeline]")
        print("Pipelines: fast, quality, premium")
        print("\nExample:")
        print("  python test_replicate_pipeline.py frame.jpg output/ fast")
        return
    
    input_path = sys.argv[1]
    output_dir = sys.argv[2] if len(sys.argv) > 2 else "output"
    pipeline = sys.argv[3] if len(sys.argv) > 3 else "fast"
    
    if not os.path.exists(input_path):
        print(f"âŒ File not found: {input_path}")
        return
    
    print(f"\nğŸ¬ Processing: {input_path}")
    print(f"ğŸ“ Output: {output_dir}")
    print(f"ğŸ”§ Pipeline: {pipeline}\n")
    
    process_single_frame(input_path, output_dir, pipeline)
    print("\nâœ… Processing complete!")


if __name__ == "__main__":
    main()
